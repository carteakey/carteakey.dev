{% macro feedCard(item, options) %}
  {% set opts = options or {} %}
  {% set variant = opts.variant or 'full' %}
  {% set compact = variant == 'compact' %}
  {% set showSummary = true %}
  {% set extraClasses = (opts.extraClasses or '') | trim %}
  {% set outerAttrs = (opts.outerAttrs or '') | trim %}
  {% if opts.showSummary is defined %}
    {% set showSummary = opts.showSummary %}
  {% endif %}

  {% set showTags = true %}
  {% if opts.showTags is defined %}
    {% set showTags = opts.showTags %}
  {% endif %}

  {% set isMicropost = item.type == 'micropost' %}
  {% set isSnippet = item.type == 'snippet' %}
  {% set isPhoto = item.type == 'photo' %}
  {% set isVibe = item.type == 'vibe' %}
  {% set isNow = item.type == 'now' %}

  {% set badgeClasses = "bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300" %}
  {% set badgeLabel = "Update" %}
  {% if item.type == 'post' %}
    {% set badgeClasses = "bg-blue-100 text-blue-800 dark:bg-blue-900/70 dark:text-blue-200" %}
    {% set badgeLabel = "Post" %}
  {% elif isSnippet %}
    {% set badgeClasses = "bg-purple-100 text-purple-800 dark:bg-purple-900/70 dark:text-purple-200" %}
    {% set badgeLabel = "Snippet" %}
  {% elif isMicropost %}
    {% set badgeClasses = "bg-amber-100 text-amber-800 dark:bg-amber-900/70 dark:text-amber-200" %}
    {% set badgeLabel = "Micropost" %}
  {% elif isPhoto %}
    {% set badgeClasses = "bg-emerald-100 text-emerald-800 dark:bg-emerald-900/60 dark:text-emerald-200" %}
    {% set badgeLabel = "Photo" %}
  {% elif isVibe %}
    {% set badgeClasses = "bg-pink-100 text-pink-800 dark:bg-pink-900/60 dark:text-pink-200" %}
    {% set badgeLabel = "Vibe" %}
  {% elif isNow %}
    {% set badgeClasses = "bg-cyan-100 text-cyan-800 dark:bg-cyan-900/60 dark:text-cyan-200" %}
    {% set badgeLabel = "Now Update" %}
  {% endif %}

  <article class="justify-center feed-card rounded-xl border border-gray-200 dark:border-gray-800 bg-gray-100 dark:bg-gray-900 p-5 sm:p-6 shadow-sm transition-shadow duration-200 hover:shadow-lg{% if extraClasses %} {{ extraClasses }}{% endif %}"{% if outerAttrs %} {{ outerAttrs | safe }}{% endif %}>
    <div class="flex flex-wrap items-center justify-between gap-3">
      <div class="flex items-center gap-2">
        <span class="inline-flex items-center gap-1.5 px-2.5 py-1 text-[0.68rem] font-semibold uppercase tracking-wider rounded-full {{ badgeClasses }}">
          {% if item.type == 'post' %}
            {% feather "edit-3", class="w-3 h-3" %}
          {% elif isSnippet %}
            {% feather "code", class="w-3 h-3" %}
          {% elif isPhoto %}
            {% feather "camera", class="w-3 h-3" %}
          {% elif isVibe %}
            {% feather "image", class="w-3 h-3" %}
          {% elif isNow %}
            {% feather "clock", class="w-3 h-3" %}
          {% else %}
            {% feather "message-circle", class="w-3 h-3" %}
          {% endif %}
          {{ badgeLabel }}
        </span>
        <time datetime="{{ item.date | htmlDateString }}" class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">
          {{ item.date | readableDate }}
        </time>
      </div>

      {% if item.readingTime %}
        <span class="text-xs font-medium text-gray-500 dark:text-gray-400">
          {{ item.readingTime }}
        </span>
      {% endif %}
    </div>

    <div class="mt-4 space-y-3">
      <h3 class="text-base md:text-lg font-semibold leading-snug text-gray-900 dark:text-white">
        {% if item.url %}
          <a href="{{ item.url | url }}" class="inline-flex items-center gap-2 hover:text-amber-600 dark:hover:text-amber-400 transition-colors">
            <span>{{ item.title }}</span>
            {% if item.url %}
              {% feather "arrow-up-right", class="w-4 h-4 opacity-60" %}
            {% endif %}
          </a>
        {% else %}
          {{ item.title }}
        {% endif %}
      </h3>

      {% if isMicropost or isNow %}
        <div class="prose-sm md:prose dark:prose-invert max-w-none">{{ item.original.templateContent | safe }}</div>
      {% elseif item.media %}
        <figure class="overflow-hidden rounded-lg border border-gray-200 dark:border-gray-700">
          <img
            src="{{ item.media.src }}"
            alt="{{ item.media.alt }}"
            loading="lazy"
            decoding="async"
            class="w-full h-auto"
          >
          {% if item.summary %}
            <figcaption class="px-3 py-2 text-xs text-gray-500 dark:text-gray-400">{{ item.summary }}</figcaption>
          {% endif %}
        </figure>
      {% elseif item.summary and showSummary %}
        <p class="text-sm leading-relaxed text-gray-600 dark:text-gray-300">{{ item.summary }}</p>
      {% endif %}
    </div>

    {% if showTags and item.tags %}
      <div class="mt-4 flex flex-wrap items-center gap-2">
        {% for tag in item.tags %}
          {% set tagUrl %}/tags/{{ tag | slugify }}/{% endset %}
          <a href="{{ tagUrl | url }}" class="text-[0.7rem] px-2 py-1 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-amber-100 dark:hover:bg-amber-900/40 transition-colors">
            #{{ tag }}
          </a>
        {% endfor %}
      </div>
    {% endif %}
  </article>
{% endmacro %}
